imports:
    - "without_repl_base.yaml"

output_dir: "output/output"

optimizer:
    type: torch.optim.Optimizer
    optimizer_cls:
      type: torch.optim.Adam
    model: "@/model"

collate_fn:
    type: mlprogram.utils.Sequence
    funcs:
        type: collections.OrderedDict
        items:
            - - "transform"
              - type: mlprogram.utils.Map
                func: "@/transform"
            - - "collate"
              - "@/collate.collate"

batch_size: 32

loss_fn:
  type: torch.nn.Sequential
  modules:
    type: collections.OrderedDict
    items:
      - - "loss"
        - type: mlprogram.nn.action_sequence.Loss
          reduction: "mean"
      - - "pick"
        - type: mlprogram.nn.Function
          f:
            type: mlprogram.utils.Pick
            key: output@action_sequence_loss
main:
  type: mlprogram.entrypoint.train_supervised
  workspace_dir: "output/workspace_training"
  output_dir: "@/output_dir"
  dataset: "@/train_dataset"
  model: "@/model"
  optimizer: "@/optimizer"
  loss: "@/loss_fn"
  evaluate:
    type: mlprogram.entrypoint.EvaluateSynthesizer
    dataset: "@/test_dataset"
    synthesizer: "@/synthesizer"
    metrics: {}
    top_n: []
    n_process: 2
  metric: "generation_rate"
  threshold: 1.0
  maximize: True
  collate: "@/collate_fn"
  batch_size: "@/batch_size"
  length:
    type: mlprogram.entrypoint.train.Iteration
    n: "@/option.n_pretrain_iteration"
  evaluation_interval:
    type: mlprogram.entrypoint.train.Iteration
    n: "@/option.interval_iter"
  snapshot_interval:
    type: mlprogram.entrypoint.train.Iteration
    n: "@/option.interval_iter"
  device: "@/device"
